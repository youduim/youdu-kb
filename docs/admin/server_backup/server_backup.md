# 有度备份数据恢复流程

## 备份说明

- 该工具用于每天进行自动备份服务器数据，仅包含通讯录人员信息、可见性配置信息、群和会话列表（不包括消息记录）。

- 默认于凌晨3点自动备份数据。

- 备份数据恢复目的：服务器出现致命故障需要恢复数据（迁移不建议）。


## 自动备份

- 自动备份服务：jgserviced，随服务一起运行

- 到达所设置的自动备份时间点时，进行自动备份工作

- 备份完成存放在备份目录下（Youdu/server/backup/(backup-restore.json中指定)

## 恢复流程

### Windows环境

1运行命令提示符。

![1584496949303](1584496949303.png)

2.将安装目录Youdu/server/bin下的jgbackup-restore.exe程序直接拖进命令提示符。

![1584497367674](1584497367674.png)

3.使用jgbackup-restore.exe程序恢复备份数据，如图示。

- 数据默认保存路径：最近三天相关数据存放于Youdu/Server/backup下，可根据需要选择对应目录数据恢复即可。


![1584499861882](1584499861882.png)

相关参数：

- r      为重新加载的意思。
- -d     指定存储路径。

![1584497871685](1584497871685.png)

4.开始数据恢复

![1584498407662](1584498407662.png)

5.恢复备份完成，请重启有度服务。

![1584498453166](1584498453166.png)

6.重启有度服务，完成自动备份数据恢复。

![1584498750927](1584498750927.png)



### Linux环境

1.确认有度服务端安装路径。

2.切换到有度安装路径，例如/mnt/youdu/bin下（以实际路径为准），执行脚本jgbackup-restore，如下图示。

相关参数：

- r      为重新加载的意思。
- -d     指定存储路径。

./jgbackup-restore r -d /mnt/youdu/backup/20200221T030000/

![1584500125732](1584500125732.png)

3.恢复备份数据完成，使用以下命令重启有度服务。

- systemctl restart youdu_service

